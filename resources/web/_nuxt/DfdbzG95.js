import{p as k,j as E,l as L,r as f,m as U,B as z,n as I,c as i,o as a,a as s,q as J,v as K,E as d,t as l,x as w,d as S,z as q,F as T,s as M,G as j,H as F,_ as G}from"./bZTsdcjj.js";const H=k("/icons/æˆ¿é—´.png"),R=k("/icons/å¯†ç .png"),Q=k("/icons/ä¸Šè¡Œ.png"),W=k("/icons/ä¸‹è¡Œ.png"),X={class:"network-page"},Y={class:"panel-row"},Z={class:"panel-section panel-half"},ss={class:"status-icon"},ts={key:0},es={key:1},os={class:"status-info"},ns={class:"status-label"},is={class:"status-ip"},as={class:"panel-section panel-half"},ls={class:"node-list-compact"},rs={key:0,class:"empty-state-small"},ds={key:1,class:"node-count"},cs={class:"count-badge"},us={class:"quick-actions"},vs={class:"panel-row"},ps={class:"panel-section panel-half"},fs={class:"config-form"},_s={class:"form-row"},ms={class:"form-row"},ys={class:"button-group"},hs=["disabled","title"],gs=["disabled"],ks={class:"panel-section panel-half"},bs={class:"traffic-stats"},ws={class:"traffic-item upload"},qs={class:"traffic-info"},Cs={class:"traffic-value"},xs={class:"traffic-speed"},Ns={class:"traffic-item download"},Bs={class:"traffic-info"},Ss={class:"traffic-value"},Ts={class:"traffic-speed"},Ms={class:"panel-section"},js={key:0,class:"empty-state"},$s={key:1,class:"device-list"},Os={class:"device-info"},Vs=["src"],As={class:"device-name"},Ps={class:"device-ip"},Ds={class:"device-status"},Es={class:"device-latency"},Ls={class:"modal-header"},Us={class:"modal-body"},zs={class:"node-list"},Is={key:0,class:"empty-state"},Js={key:1},Ks={class:"node-content"},Fs={class:"node-address"},Gs=["onClick"],Hs={class:"add-node-form"},Rs=E({__name:"index",setup(Qs){const{showToast:n}=L(),{fetchApi:_,init:$,networkStatus:u,peers:C,traffic:O}=z(),c=f({network_name:"",network_secret:"",peers:[]}),r=f([]),v=f(""),m=f(!1),y=U(()=>O.value||{tx_bytes:0,rx_bytes:0,tx_speed:0,rx_speed:0}),h=f(!1),g=f(!1);async function V(){if(!c.value.network_name||!c.value.network_secret){n("è¯·è¾“å…¥æˆ¿é—´åç§°å’Œå¯†ç ","error");return}if(r.value.length===0){n("è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹","error");return}h.value=!0;try{const t=await(await _("/api/easytier/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({network_name:c.value.network_name,network_secret:c.value.network_secret,peers:r.value})})).json();t.ok?n("è¿æ¥æˆåŠŸï¼","success"):n(t.error||"è¿æ¥å¤±è´¥","error")}catch(e){n(`è¿æ¥å¤±è´¥: ${e.message}`,"error")}finally{h.value=!1}}async function A(){g.value=!0;try{const t=await(await _("/api/easytier/stop",{method:"POST"})).json();if(t.ok){if(typeof window<"u"){const o=new CustomEvent("easytier-update",{detail:{running:!1,connected:!1,virtual_ip:"æœªè¿æ¥"}});window.dispatchEvent(o)}n("å·²æ–­å¼€è¿æ¥","info")}else n(t.error||"æ–­å¼€å¤±è´¥","error")}catch(e){n(`æ–­å¼€å¤±è´¥: ${e.message}`,"error")}finally{g.value=!1}}async function x(){try{const t=await(await _("/api/easytier/nodes")).json();Array.isArray(t.nodes)&&(r.value=t.nodes)}catch(e){console.error("åŠ è½½èŠ‚ç‚¹å¤±è´¥:",e)}}async function N(){if(!v.value.trim()){n("è¯·è¾“å…¥èŠ‚ç‚¹åœ°å€","error");return}try{const t=await(await _("/api/easytier/nodes/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({node:v.value.trim()})})).json();t.ok?(r.value.push(v.value.trim()),v.value="",n("èŠ‚ç‚¹æ·»åŠ æˆåŠŸ","success")):n(t.error||"æ·»åŠ å¤±è´¥","error")}catch(e){n(`æ·»åŠ å¤±è´¥: ${e.message}`,"error")}}async function P(e){try{const o=await(await _("/api/easytier/nodes/remove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({node:e})})).json();o.ok?(r.value=r.value.filter(p=>p!==e),n("èŠ‚ç‚¹åˆ é™¤æˆåŠŸ","success")):n(o.error||"åˆ é™¤å¤±è´¥","error")}catch(t){n(`åˆ é™¤å¤±è´¥: ${t.message}`,"error")}}function b(e){if(e===0)return"0 B";const t=1024,o=["B","KB","MB","GB"],p=Math.floor(Math.log(e)/Math.log(t));return Math.round(e/Math.pow(t,p)*100)/100+" "+o[p]}function B(e){return b(e)+"/s"}function D(e){return e<0||e===null||e===void 0?"/icons/drop.png":e<50?"/icons/good.png":e<150?"/icons/fluid.png":"/icons/laggy.png"}return I(()=>{$(),x()}),(e,t)=>(a(),i("div",X,[s("div",Y,[s("div",Z,[t[7]||(t[7]=s("h3",{class:"section-title"},"è¿æ¥çŠ¶æ€",-1)),s("div",{class:K(["status-card",{connected:d(u).connected}])},[s("div",ss,[d(u).connected?(a(),i("span",ts,"âœ“")):(a(),i("span",es,"â—‹"))]),s("div",os,[s("div",ns,l(d(u).connected?"å·²è¿æ¥":"æœªè¿æ¥"),1),s("div",is,"è™šæ‹ŸIP: "+l(d(u).virtual_ip),1)])],2)]),s("div",as,[s("div",{class:"section-header"},[t[8]||(t[8]=s("h3",{class:"section-title"},"èŠ‚ç‚¹ç®¡ç†",-1)),s("button",{onClick:x,class:"qq-btn qq-btn-small"},"åˆ·æ–°")]),s("div",ls,[r.value.length===0?(a(),i("div",rs,[...t[9]||(t[9]=[s("p",null,"æš‚æ— è‡ªå®šä¹‰èŠ‚ç‚¹",-1)])])):(a(),i("div",ds,[s("span",cs,l(r.value.length),1),t[10]||(t[10]=s("span",{class:"count-text"},"ä¸ªè‡ªå®šä¹‰èŠ‚ç‚¹",-1))]))]),s("div",us,[s("button",{onClick:t[0]||(t[0]=o=>m.value=!0),class:"qq-btn qq-btn-primary qq-btn-block"},"ç®¡ç†èŠ‚ç‚¹")])])]),s("div",vs,[s("div",ps,[t[13]||(t[13]=s("h3",{class:"section-title"},"ç½‘ç»œé…ç½®",-1)),s("div",fs,[s("div",_s,[t[11]||(t[11]=s("label",{class:"form-label"},[s("img",{src:H,class:"label-icon-img",alt:"æˆ¿é—´"}),S(" æˆ¿é—´åç§° ")],-1)),w(s("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>c.value.network_name=o),placeholder:"è¾“å…¥æˆ¿é—´åç§°",class:"qq-input"},null,512),[[q,c.value.network_name]])]),s("div",ms,[t[12]||(t[12]=s("label",{class:"form-label"},[s("img",{src:R,class:"label-icon-img",alt:"å¯†ç "}),S(" æˆ¿é—´å¯†ç  ")],-1)),w(s("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>c.value.network_secret=o),type:"password",placeholder:"è¾“å…¥æˆ¿é—´å¯†ç ",class:"qq-input"},null,512),[[q,c.value.network_secret]])]),s("div",ys,[s("button",{onClick:V,class:"qq-btn qq-btn-primary",disabled:d(u).connected||h.value||r.value.length===0,title:r.value.length===0?"è¯·å…ˆæ·»åŠ èŠ‚ç‚¹":""},l(h.value?"è¿æ¥ä¸­...":d(u).connected?"å·²è¿æ¥":"è¿æ¥æˆ¿é—´"),9,hs),s("button",{onClick:A,class:"qq-btn qq-btn-danger",disabled:!d(u).connected||g.value},l(g.value?"æ–­å¼€ä¸­...":"æ–­å¼€è¿æ¥"),9,gs)])])]),s("div",ks,[t[19]||(t[19]=s("h3",{class:"section-title"},"æµé‡ç»Ÿè®¡",-1)),s("div",bs,[s("div",ws,[t[15]||(t[15]=s("img",{src:Q,class:"traffic-icon-img",alt:"ä¸Šä¼ "},null,-1)),s("div",qs,[t[14]||(t[14]=s("div",{class:"traffic-label"},"ä¸Šä¼ ",-1)),s("div",Cs,l(b(y.value.tx_bytes)),1),s("div",xs,l(B(y.value.tx_speed)),1)])]),t[18]||(t[18]=s("div",{class:"traffic-divider"},null,-1)),s("div",Ns,[t[17]||(t[17]=s("img",{src:W,class:"traffic-icon-img",alt:"ä¸‹è½½"},null,-1)),s("div",Bs,[t[16]||(t[16]=s("div",{class:"traffic-label"},"ä¸‹è½½",-1)),s("div",Ss,l(b(y.value.rx_bytes)),1),s("div",Ts,l(B(y.value.rx_speed)),1)])])])])]),s("div",Ms,[t[21]||(t[21]=s("h3",{class:"section-title"},"åœ¨çº¿è®¾å¤‡",-1)),d(C).length===0?(a(),i("div",js,[...t[20]||(t[20]=[s("p",null,"æš‚æ— åœ¨çº¿è®¾å¤‡",-1)])])):(a(),i("div",$s,[(a(!0),i(T,null,M(d(C),o=>(a(),i("div",{key:o.ipv4+o.hostname,class:"device-item"},[s("div",Os,[s("img",{src:D(o.latency),class:"device-icon",alt:"å»¶è¿Ÿå›¾æ ‡"},null,8,Vs),s("div",null,[s("div",As,l(o.hostname||"æœªçŸ¥è®¾å¤‡"),1),s("div",Ps,l(o.ipv4),1)])]),s("div",Ds,[s("span",Es,l(o.latency)+"ms",1)])]))),128))]))]),m.value?(a(),i("div",{key:0,class:"modal-overlay",onClick:t[6]||(t[6]=o=>m.value=!1)},[s("div",{class:"modal-content",onClick:t[5]||(t[5]=j(()=>{},["stop"]))},[s("div",Ls,[t[22]||(t[22]=s("h3",null,"èŠ‚ç‚¹ç®¡ç†",-1)),s("button",{onClick:t[3]||(t[3]=o=>m.value=!1),class:"modal-close"},"Ã—")]),s("div",Us,[s("div",zs,[r.value.length===0?(a(),i("div",Is,[...t[23]||(t[23]=[s("p",null,"æš‚æ— è‡ªå®šä¹‰èŠ‚ç‚¹",-1)])])):(a(),i("div",Js,[(a(!0),i(T,null,M(r.value,(o,p)=>(a(),i("div",{key:p,class:"node-item"},[s("div",Ks,[t[24]||(t[24]=s("div",{class:"node-icon"},"ğŸŒ",-1)),s("div",Fs,l(o),1)]),s("button",{onClick:j(Ws=>P(o),["stop"]),class:"qq-btn qq-btn-danger qq-btn-small"},"åˆ é™¤",8,Gs)]))),128))]))]),s("div",Hs,[w(s("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>v.value=o),placeholder:"è¾“å…¥èŠ‚ç‚¹åœ°å€ï¼Œå¦‚: tcp://example.com:11010",class:"qq-input",onKeyup:F(N,["enter"])},null,544),[[q,v.value]]),s("button",{onClick:N,class:"qq-btn qq-btn-primary"},"æ·»åŠ èŠ‚ç‚¹")])])])])):J("",!0)]))}}),Ys=G(Rs,[["__scopeId","data-v-d5cb0821"]]);export{Ys as default};
