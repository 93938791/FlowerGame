import{p as Y,j as fe,k as pe,l as ge,r,m as _e,n as me,c as o,o as n,a,q as p,d as _,t as i,F as $,s as C,v as R,x as O,y as z,z as be,A as he,B as ye,_ as we}from"./bZTsdcjj.js";const ke=Y("/icons/java.png"),Te=Y("/icons/minecraft.png"),xe={class:"game-page"},qe={class:"panel-section"},Ve={class:"java-section"},je={class:"java-status-row"},Fe={class:"status-indicator"},Ae={key:0,class:"status-text loading"},$e={key:1,class:"status-text success"},Ce={key:2,class:"status-text warning"},Je={class:"action-buttons"},Me=["disabled"],Ne={key:0,class:"java-install-box"},Ie=["disabled"],Pe={key:0,class:"loading-spinner"},Oe={key:1,class:"info-hint mt-2"},Se={class:"panel-section"},Ee={class:"download-form"},Le={class:"form-group"},Ue={class:"version-type-grid"},Be=["onClick"],Ke=["src","alt"],Re={class:"type-label"},ze={class:"form-group"},Ge={class:"version-filter-group"},He={class:"version-type-filter"},Qe=["onClick"],We={class:"version-selector"},Xe=["value"],Ye=["disabled"],Ze={key:0,class:"form-group"},De={class:"version-selector"},es=["disabled"],ss={value:""},ts=["value"],as=["disabled"],os={key:0,class:"loading-spinner"},ns={key:0,class:"loading-hint"},rs={key:1,class:"form-group"},is={class:"version-selector"},ls=["disabled"],us={value:""},cs=["value"],ds=["disabled"],vs={key:0,class:"loading-spinner"},fs={key:0,class:"loading-hint"},ps={key:1,class:"info-hint"},gs={class:"form-group"},_s={key:0,class:"error-hint"},ms={key:1,class:"success-hint"},bs={class:"form-actions"},hs=["disabled"],ys={class:"btn-icon"},ws={key:0,class:"panel-section"},ks={class:"progress-list"},Ts={class:"progress-header"},xs={class:"progress-name"},qs={class:"progress-percentage"},Vs={class:"progress-bar"},js={class:"progress-status"},Fs=fe({__name:"game",setup(As){const Z=pe(),{showToast:v}=ge(),{fetchApi:m}=ye(),D=[{label:"åŽŸç‰ˆ",value:"vanilla",icon:"/icons/vanilla.png"},{label:"Fabric",value:"fabric",icon:"/icons/fabric.png"},{label:"Forge",value:"forge",icon:"/icons/forge.png"},{label:"NeoForge",value:"neoforge",icon:"/icons/neoforge.png"}],ee=[{label:"æ‰€æœ‰ç‰ˆæœ¬",value:""},{label:"æ­£å¼ç‰ˆ",value:"release"},{label:"å¿«ç…§ç‰ˆ",value:"snapshot"}],l=r("vanilla"),S=r("release"),d=r(""),x=r(""),J=r([]),b=r(""),q=r([]),f=r(""),V=r(!1),G=r([]),H=r([]),M=r(!1),h=r(!1),y=r(!1),k=r(!1),u=r([]),j=r(!1),E=r(!1),Q=r(""),N=r(!1),I=r("");async function W(){j.value=!0,I.value="";try{const e=await(await m("/api/java/info")).json();e.ok&&e.data&&(E.value=e.data.installed,Q.value=e.data.version||"æœªçŸ¥ç‰ˆæœ¬")}catch(s){console.error(s)}finally{j.value=!1}}async function se(){window.open("https://aka.ms/download-jdk/microsoft-jdk-21-windows-x64.msi","_blank"),v("å·²å¼€å§‹ä¸‹è½½ Microsoft OpenJDK 21ï¼Œä¸‹è½½å®ŒæˆåŽè¯·æ‰‹åŠ¨å®‰è£…","success"),I.value='è¯·ä¸‹è½½å¹¶å®‰è£…å®ŒæˆåŽç‚¹å‡»"åˆ·æ–°çŠ¶æ€"æŒ‰é’®'}const X=_e(()=>!f.value||f.value.trim()===""||V.value?!1:l.value==="vanilla"?d.value.length>0:d.value.length>0&&x.value.length>0);function te(){const s=f.value.trim();if(!s){V.value=!1;return}V.value=G.value.includes(s)}async function ae(){try{const e=await(await m("/api/minecraft/installed-versions")).json();e.ok&&Array.isArray(e.versions)&&(G.value=e.versions.map(t=>t.id))}catch(s){console.error("åŠ è½½å·²å®‰è£…ç‰ˆæœ¬å¤±è´¥:",s)}}function oe(s){l.value=s,x.value="",J.value=[],b.value="",q.value=[],s!=="vanilla"&&d.value&&(U(),s==="fabric"&&B())}function ne(s){S.value=s,L()}function re(s){return{release:"æ­£å¼ç‰ˆ",snapshot:"å¿«ç…§ç‰ˆ",old_beta:"Beta",old_alpha:"Alpha"}[s?.toLowerCase()]||"æ­£å¼ç‰ˆ"}function ie(){l.value!=="vanilla"&&d.value&&(U(),l.value==="fabric"&&B())}function le(s){if(typeof s=="string"){try{const e=JSON.parse(s);if(e.loader&&e.loader.version){const t=e.loader.stable?"ç¨³å®šç‰ˆ":"æµ‹è¯•ç‰ˆ";return`${e.loader.version} (${t})`}if(e.version)return e.version}catch{return s}return s}if(s.loader&&s.loader.version){const e=s.loader.stable?"ç¨³å®šç‰ˆ":"æµ‹è¯•ç‰ˆ";return`${s.loader.version} (${e})`}if(s.stable!==void 0){const e=s.stable?"ç¨³å®šç‰ˆ":"æµ‹è¯•ç‰ˆ";return`${s.version} (${e})`}return s.version||s}function ue(s){if(typeof s=="string"){try{const e=JSON.parse(s);if(e.loader&&e.loader.version)return e.loader.version;if(e.version)return e.version}catch{return s}return s}return s.loader&&s.loader.version?s.loader.version:s.version||s}function ce(s){if(typeof s=="string")return s;if(s.version){let e=s.version;if(s.name&&s.name!==s.version&&(e=`${s.version} - ${s.name}`),s.downloads){const t=s.downloads>=1e3?`${(s.downloads/1e3).toFixed(1)}K`:s.downloads;e+=` (â¬‡ï¸ ${t})`}return e}return s.version||s}async function L(){M.value=!0;try{const s=S.value||"",e=s?`/api/minecraft/versions?version_type=${s}`:"/api/minecraft/versions",c=await(await m(e)).json();c.ok&&Array.isArray(c.versions)?H.value=c.versions:c.error&&v(`åŠ è½½å¤±è´¥: ${c.error}`,"error")}catch(s){v(`åŠ è½½å¤±è´¥: ${s.message}`,"error")}finally{M.value=!1}}async function U(){if(!(!d.value||l.value==="vanilla")){h.value=!0,J.value=[],x.value="";try{const e=await(await m(`/api/minecraft/loader-versions?loader_type=${l.value}&mc_version=${d.value}`)).json();e.ok&&Array.isArray(e.versions)?J.value=e.versions.map(t=>{if(typeof t=="string")try{return JSON.parse(t)}catch{return{version:t}}return t}):v("èŽ·å–åŠ è½½å™¨ç‰ˆæœ¬å¤±è´¥","error")}catch(s){v(`åŠ è½½å¤±è´¥: ${s.message}`,"error")}finally{h.value=!1}}}async function B(){if(!(!d.value||l.value!=="fabric")){y.value=!0,q.value=[],b.value="";try{const e=await(await m(`/api/minecraft/fabric-api-versions?mc_version=${d.value}`)).json();e.ok&&Array.isArray(e.versions)?q.value=e.versions.map(t=>typeof t=="string"?{version:t,game_version:d.value}:t):q.value=[]}catch(s){console.error("åŠ è½½ Fabric API ç‰ˆæœ¬å¤±è´¥:",s),q.value=[]}finally{y.value=!1}}}async function de(){if(!X.value){!f.value||f.value.trim()===""?v("è¯·è¾“å…¥ç‰ˆæœ¬åç§°","error"):V.value?v("è¯¥åç§°å·²å­˜åœ¨ï¼Œè¯·ä½¿ç”¨å…¶ä»–åç§°","error"):v("è¯·é€‰æ‹©è¦ä¸‹è½½çš„ç‰ˆæœ¬","error");return}k.value=!0,u.value=[{id:"version_info",name:"ðŸ“„ ç‰ˆæœ¬ä¿¡æ¯",progress:0,status:"pending",statusText:"ç­‰å¾…ä¸­..."},{id:"client_jar",name:"ðŸŽ® JAR",progress:0,status:"pending",statusText:"ç­‰å¾…ä¸­..."},{id:"libraries",name:"ðŸ“¦ ä¾èµ–åº“",progress:0,status:"pending",statusText:"ç­‰å¾…ä¸­..."},{id:"assets",name:"ðŸŽ¨ èµ„æº",progress:0,status:"pending",statusText:"ç­‰å¾…ä¸­..."}],l.value==="fabric"&&(u.value.push({id:"loader_info",name:"ðŸ§µ Fabric é…ç½®",progress:0,status:"pending",statusText:"ç­‰å¾…ä¸­..."},{id:"loader_libraries",name:"ðŸ“¦ Fabric ä¾èµ–åº“",progress:0,status:"pending",statusText:"ç­‰å¾…ä¸­..."}),b.value&&u.value.push({id:"fabric_api",name:"ðŸ”§ Fabric API",progress:0,status:"pending",statusText:"ç­‰å¾…ä¸­..."})),l.value==="forge"&&u.value.push({id:"loader_info",name:"ðŸ”¨ Forge é…ç½®",progress:0,status:"pending",statusText:"ç­‰å¾…ä¸­..."},{id:"forge_libraries",name:"ðŸ“¦ Forge ä¾èµ–åº“",progress:0,status:"pending",statusText:"ç­‰å¾…ä¸­..."},{id:"extract_data",name:"ðŸ“‚ æå–æ•°æ®",progress:0,status:"pending",statusText:"ç­‰å¾…ä¸­..."},{id:"processors",name:"âš™ï¸ æ‰§è¡Œå¤„ç†å™¨",progress:0,status:"pending",statusText:"ç­‰å¾…ä¸­..."},{id:"generate_json",name:"ðŸ“ ç”Ÿæˆé…ç½®",progress:0,status:"pending",statusText:"ç­‰å¾…ä¸­..."}),l.value==="neoforge"&&u.value.push({id:"loader_info",name:"ðŸ”§ NeoForge é…ç½®",progress:0,status:"pending",statusText:"ç­‰å¾…ä¸­..."},{id:"forge_libraries",name:"ðŸ“¦ NeoForge ä¾èµ–åº“",progress:0,status:"pending",statusText:"ç­‰å¾…ä¸­..."},{id:"extract_data",name:"ðŸ“‚ æå–æ•°æ®",progress:0,status:"pending",statusText:"ç­‰å¾…ä¸­..."},{id:"processors",name:"âš™ï¸ æ‰§è¡Œå¤„ç†å™¨",progress:0,status:"pending",statusText:"ç­‰å¾…ä¸­..."},{id:"generate_json",name:"ðŸ“ ç”Ÿæˆé…ç½®",progress:0,status:"pending",statusText:"ç­‰å¾…ä¸­..."});let s="";try{if(l.value==="vanilla"){const t=await(await m("/api/minecraft/download",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({version_id:d.value.trim(),custom_name:f.value.trim()})})).json();if(!t.ok)throw new Error(t.error||"ä¸‹è½½è¯·æ±‚å¤±è´¥");s=f.value.trim()}else{const e={mc_version:d.value.trim(),loader_type:l.value,loader_version:x.value,custom_name:f.value.trim()||null};l.value==="fabric"&&b.value&&(e.fabric_api_version=b.value);const c=await(await m("/api/minecraft/download-with-loader",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();if(!c.ok)throw new Error(c.error||"ä¸‹è½½è¯·æ±‚å¤±è´¥");s=c.task_id}await ve(s)}catch(e){v(`ä¸‹è½½å¤±è´¥: ${e.message}`,"error"),u.value.forEach(t=>{t.status!=="completed"&&(t.status="failed",t.statusText="ä¸‹è½½å¤±è´¥")}),k.value=!1}}async function ve(s){const e={version_manifest:0,version_info:0,client_jar:1,libraries:2,assets:3};l.value==="fabric"?(e.loader_info=4,e.loader_libraries=5,b.value&&(e.fabric_api=6)):(l.value==="forge"||l.value==="neoforge")&&(e.loader_info=4,e.forge_libraries=5,e.extract_data=6,e.processors=7,e.generate_json=8);let t=0;const c=600;for(;t<c;)try{const F=await m(`/api/minecraft/download-progress?task_id=${encodeURIComponent(s)}`);if(!F.ok){if(F.status===404){await new Promise(w=>setTimeout(w,500)),t++;continue}throw new Error(`èŽ·å–è¿›åº¦å¤±è´¥: ${F.status}`)}const T=await F.json();if(T.ok&&T.progress){const w=T.progress,K=w.stage,P=e[K]??-1;if(P>=0&&P<u.value.length){const g=u.value[P];g.progress=w.percentage||0,g.status="downloading",g.statusText=w.message||"ä¸‹è½½ä¸­...";for(let A=0;A<P;A++)u.value[A].status!=="completed"&&(u.value[A].progress=100,u.value[A].status="completed",u.value[A].statusText="âœ“ å®Œæˆ")}if(K==="complete"){u.value.forEach(g=>{g.progress=100,g.status="completed",g.statusText="âœ“ å®Œæˆ"}),v(`ç‰ˆæœ¬ ${s} ä¸‹è½½æˆåŠŸï¼`,"success"),k.value=!1,await new Promise(g=>setTimeout(g,1e3)),u.value=[],Z.push("/multiplayer");return}if(K==="error")throw new Error(w.message||"ä¸‹è½½å¤±è´¥")}await new Promise(w=>setTimeout(w,1e3)),t++}catch(F){v(`ä¸‹è½½å¤±è´¥: ${F.message}`,"error"),u.value.forEach(T=>{T.status!=="completed"&&(T.status="failed",T.statusText="å¤±è´¥")}),k.value=!1;return}}return me(()=>{L(),ae(),W()}),(s,e)=>(n(),o("div",xe,[a("div",qe,[e[5]||(e[5]=a("h3",{class:"section-title"},[a("img",{src:ke,class:"title-icon-img",alt:"Java"}),_(" Java çŽ¯å¢ƒ ")],-1)),a("div",Ve,[a("div",je,[a("div",Fe,[j.value?(n(),o("span",Ae,"â³ æ£€æµ‹ä¸­...")):E.value?(n(),o("span",$e,"âœ… å·²å®‰è£… Java ("+i(Q.value)+")",1)):(n(),o("span",Ce,"âš ï¸ æœªæ£€æµ‹åˆ° Java çŽ¯å¢ƒ"))]),a("div",Je,[a("button",{onClick:W,class:"qq-btn qq-btn-sm",disabled:j.value||N.value},i(j.value?"æ£€æµ‹ä¸­":"åˆ·æ–°çŠ¶æ€"),9,Me)])]),!j.value&&!E.value?(n(),o("div",Ne,[e[4]||(e[4]=a("div",{class:"install-info"},[a("p",null,"Minecraft è¿è¡Œéœ€è¦ Java çŽ¯å¢ƒã€‚"),a("p",null,[_("æŽ¨èå®‰è£… "),a("strong",null,"Microsoft OpenJDK 21"),_(" (å…¼å®¹é«˜ç‰ˆæœ¬ MC)")])],-1)),a("button",{onClick:se,class:"qq-btn qq-btn-primary qq-btn-block",disabled:N.value},[N.value?(n(),o("span",Pe)):p("",!0),_(" "+i(N.value?"æ­£åœ¨ä¸‹è½½å®‰è£…...":"ä¸‹è½½ Microsoft OpenJDK 21"),1)],8,Ie)])):p("",!0),I.value?(n(),o("div",Oe,i(I.value),1)):p("",!0)])]),a("div",Se,[e[12]||(e[12]=a("h3",{class:"section-title"},[a("img",{src:Te,class:"title-icon-img",alt:"Minecraft"}),_(" Minecraft ä¸‹è½½ ")],-1)),a("div",Ee,[a("div",Le,[e[6]||(e[6]=a("label",{class:"form-label"},"ç‰ˆæœ¬ç±»åž‹",-1)),a("div",Ue,[(n(),o($,null,C(D,t=>a("button",{key:t.value,class:R(["type-btn",{active:l.value===t.value}]),onClick:c=>oe(t.value)},[a("img",{src:t.icon,alt:t.label,class:"type-icon"},null,8,Ke),a("span",Re,i(t.label),1)],10,Be)),64))])]),a("div",ze,[e[8]||(e[8]=a("label",{class:"form-label"},"Minecraft ç‰ˆæœ¬",-1)),a("div",Ge,[a("div",He,[(n(),o($,null,C(ee,t=>a("button",{key:t.value,class:R(["filter-btn",{active:S.value===t.value}]),onClick:c=>ne(t.value)},i(t.label),11,Qe)),64))])]),a("div",We,[O(a("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>d.value=t),class:"qq-select",onChange:ie},[e[7]||(e[7]=a("option",{value:""},"è¯·é€‰æ‹©ç‰ˆæœ¬",-1)),(n(!0),o($,null,C(H.value,t=>(n(),o("option",{key:t.id,value:t.id},i(t.id)+" ("+i(re(t.type))+") ",9,Xe))),128))],544),[[z,d.value]]),a("button",{onClick:L,class:"qq-btn",disabled:M.value},i(M.value?"åŠ è½½ä¸­...":"åˆ·æ–°"),9,Ye)])]),l.value!=="vanilla"?(n(),o("div",Ze,[e[9]||(e[9]=a("label",{class:"form-label"},"åŠ è½½å™¨ç‰ˆæœ¬",-1)),a("div",De,[O(a("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>x.value=t),class:"qq-select",disabled:h.value},[a("option",ss,i(h.value?"åŠ è½½ä¸­...":"è¯·é€‰æ‹©åŠ è½½å™¨ç‰ˆæœ¬"),1),(n(!0),o($,null,C(J.value,(t,c)=>(n(),o("option",{key:c,value:ue(t)},i(le(t)),9,ts))),128))],8,es),[[z,x.value]]),a("button",{onClick:U,class:"qq-btn",disabled:!d.value||h.value},[h.value?(n(),o("span",os)):p("",!0),_(" "+i(h.value?"åŠ è½½ä¸­":"åˆ·æ–°"),1)],8,as)]),h.value?(n(),o("div",ns," â³ æ­£åœ¨èŽ·å–åŠ è½½å™¨ç‰ˆæœ¬åˆ—è¡¨... ")):p("",!0)])):p("",!0),l.value==="fabric"?(n(),o("div",rs,[e[10]||(e[10]=a("label",{class:"form-label"},"Fabric APIç‰ˆæœ¬",-1)),a("div",is,[O(a("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>b.value=t),class:"qq-select",disabled:y.value},[a("option",us,i(y.value?"åŠ è½½ä¸­...":"ä¸å®‰è£… Fabric API"),1),(n(!0),o($,null,C(q.value,t=>(n(),o("option",{key:t.version,value:t.version},i(ce(t)),9,cs))),128))],8,ls),[[z,b.value]]),a("button",{onClick:B,class:"qq-btn",disabled:!d.value||y.value},[y.value?(n(),o("span",vs)):p("",!0),_(" "+i(y.value?"åŠ è½½ä¸­":"åˆ·æ–°"),1)],8,ds)]),y.value?(n(),o("div",fs," â³ æ­£åœ¨èŽ·å– Fabric API ç‰ˆæœ¬åˆ—è¡¨... ")):(n(),o("div",ps," ðŸ’¡ Fabric API æ˜¯è¿è¡Œå¤§å¤šæ•° Fabric æ¨¡ç»„æ‰€å¿…éœ€çš„æ ¸å¿ƒåº“ "))])):p("",!0),a("div",gs,[e[11]||(e[11]=a("label",{class:"form-label"},[_("è‡ªå®šä¹‰åç§° "),a("span",{class:"required-mark"},"*")],-1)),O(a("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>f.value=t),placeholder:"è¯·è¾“å…¥ç‰ˆæœ¬åç§°ï¼ˆå¿…å¡«ï¼‰",class:"qq-input",onInput:te},null,544),[[be,f.value]]),V.value?(n(),o("div",_s," âš ï¸ è¯¥åç§°å·²å­˜åœ¨ï¼Œè¯·ä½¿ç”¨å…¶ä»–åç§° ")):p("",!0),f.value&&!V.value?(n(),o("div",ms," âœ“ åç§°å¯ç”¨ ")):p("",!0)]),a("div",bs,[a("button",{onClick:de,class:"qq-btn qq-btn-download qq-btn-large qq-btn-block",disabled:!X.value||k.value},[a("span",ys,i(k.value?"â³":"â¬‡ï¸"),1),_(" "+i(k.value?"ä¸‹è½½ä¸­...":"å¼€å§‹ä¸‹è½½"),1)],8,hs)])])]),u.value.length>0?(n(),o("div",ws,[e[13]||(e[13]=a("h4",{class:"section-title"},"ä¸‹è½½è¿›åº¦",-1)),a("div",ks,[(n(!0),o($,null,C(u.value,t=>(n(),o("div",{key:t.id,class:"progress-item"},[a("div",Ts,[a("span",xs,i(t.name),1),a("span",qs,i(t.progress)+"%",1)]),a("div",Vs,[a("div",{class:R(["progress-bar-fill",{"progress-success":t.status==="completed","progress-error":t.status==="failed","progress-active":t.status==="downloading"}]),style:he({width:t.progress+"%"})},null,6)]),a("div",js,i(t.statusText),1)]))),128))])])):p("",!0)]))}}),Cs=we(Fs,[["__scopeId","data-v-f3f5acc8"]]);export{Cs as default};
