import{p as $e,r as l,B as de,j as xe,J as ee,K as Ie,m as se,n as Te,c as o,o as n,a as t,q as d,F as _,s as g,v as Me,t as i,x as b,z as te,H as Ne,d as N,y as E,I as Ue,G as R,A as Le,L as Pe,_ as Oe}from"./bZTsdcjj.js";const Ae=$e("/icons/è¯­è¨€ç¿»è¯‘.png"),ue=l(null),ae=l(!1);let k=null,U=null;const Fe=()=>{const{getWsUrl:oe}=de();function p(){if(typeof window>"u"||k&&(k.readyState===WebSocket.OPEN||k.readyState===WebSocket.CONNECTING))return;const B=oe("/ws/status");try{k=new WebSocket(B),k.onopen=()=>{ae.value=!0,U&&(clearTimeout(U),U=null)},k.onmessage=q=>{try{const c=JSON.parse(q.data);ue.value=c}catch(c){console.error("WS parse error:",c)}},k.onclose=()=>{ae.value=!1,k=null,U||(U=setTimeout(()=>p(),3e3))}}catch(q){console.error("WS connection failed:",q)}}return p(),{messages:ue,isConnected:ae}},We={class:"resources-page"},Ee={class:"panel-section"},Re={class:"tabs"},Be=["onClick"],Ge={class:"search-bar-container"},Je={class:"search-bar"},ze=["disabled"],Ke={key:0,class:"loading-spinner-sm"},He={key:0,class:"filters"},Qe={key:0,class:"resources-grid"},Xe=["src"],Ye={class:"resource-info"},Ze={class:"resource-header"},es=["title"],ss={class:"resource-actions-top"},ts=["onClick"],as={key:1,class:"loading-spinner-xs"},os=["title"],ns={class:"resource-meta"},ls={class:"author"},is={class:"downloads"},rs={class:"resource-actions"},cs=["href"],us=["onClick"],ds={key:0,class:"loading-spinner-sm"},vs={key:1,class:"load-text"},ps={key:2,class:"no-results"},fs={key:3,class:"loading-container"},ms={key:0,class:"download-progress-toast"},hs={class:"progress-header"},_s=["title"],gs={class:"percent"},ks={class:"progress-bar-bg"},ys={key:0,class:"progress-detail"},bs={class:"modal-content"},ws={class:"modal-header"},Cs={class:"version-filters"},qs=["value"],Ss=["value"],Vs={key:0,class:"loading-container"},js={key:1,class:"version-list"},Ds={class:"version-info-main"},$s=["title"],xs={class:"version-number"},Is={class:"version-tags"},Ts={class:"version-actions"},Ms={class:"date"},Ns=["onClick"],Us={key:2,class:"no-results"},Ls={class:"modal-content download-modal"},Ps={class:"modal-header"},Os={class:"download-form"},As={class:"form-group"},Fs=["value"],Ws={key:0,class:"hint-text"},Es={key:1,class:"warning-text"},Rs={class:"form-group"},Bs={class:"input-group"},Gs={key:0,class:"path-preview"},Js={class:"modal-footer"},zs=["disabled"],Ks={key:0,class:"loading-spinner-sm"},Hs={class:"modal-content download-modal"},Qs={class:"download-form"},Xs={class:"form-group"},Ys={class:"path-preview"},Zs={class:"form-group"},et={class:"modal-footer"},st=["disabled"],tt={key:0,class:"loading-spinner-sm"},at=xe({__name:"resources",setup(oe){const{fetchApi:p}=de(),{messages:B}=Fe(),q=[{id:"mod",name:"æ¨¡ç»„ (Mods)"},{id:"shader",name:"å…‰å½± (Shaders)"},{id:"modpack",name:"æ•´åˆåŒ… (Modpacks)"},{id:"datapack",name:"æ•°æ®åŒ… (Data Packs)"},{id:"resourcepack",name:"èµ„æºåŒ… (Resource Packs)"}],c=l("mod"),S=l(""),f=l([]),m=l(!1),ne=l(!1),L=l(""),G=l(0),J=l(0),V=l(!1),z=l(null);let w=null;const v=l({filename:"",percent:0,total:0,current:0,message:""});ee(B,a=>{if(a)if(a.type==="download_progress"){const e=a.data;v.value={filename:e.filename,percent:e.percent,total:e.total||0,current:e.current||0,message:e.message||""},e.percent>=100&&e.message!=="å®‰è£…å®Œæˆ"&&setTimeout(()=>{v.value.filename===e.filename&&(v.value={filename:"",percent:0,total:0,current:0,message:""})},3e3)}else a.type==="notification"&&a.data.type==="success"&&a.data.title==="å®‰è£…å®Œæˆ"&&setTimeout(()=>{v.value={filename:"",percent:0,total:0,current:0,message:""}},3e3)});const K=l(!1),C=l(!1),j=l([]),H=l(""),u=l({url:"",filename:"",targetVersion:"",path:"",type:"",loaders:[]}),D=l(""),Q=l(!1),X=l(null),$=l([]),P=l(!1),x=l(""),I=l(""),ve=a=>new Intl.NumberFormat("en-US",{notation:"compact",compactDisplay:"short"}).format(a),pe=a=>new Date(a).toLocaleDateString(),O=()=>{G.value=0,Y()},fe=async()=>{V.value||m.value||(G.value+=20,V.value=!0,await Y(!0),V.value=!1)},me=()=>{w&&w.disconnect(),w=new IntersectionObserver(a=>{a[0].isIntersecting&&!V.value&&!m.value&&fe()},{root:null,rootMargin:"100px",threshold:.1}),z.value&&w.observe(z.value)};ee(()=>f.value.length,()=>{Pe(()=>{f.value.length>0&&J.value>f.value.length&&me()})}),Ie(()=>{w&&w.disconnect()});const he=async()=>{try{const[a,e]=await Promise.all([p("/api/minecraft/installed-versions"),p("/api/minecraft/config")]),s=await a.json();s.ok&&(j.value=s.versions);const r=await e.json();r.ok&&(H.value=r.minecraft_dir)}catch(a){console.error("Failed to fetch minecraft info",a)}},_e=(a,e)=>{u.value={url:a.url,filename:a.filename,targetVersion:j.value.length>0?j.value[0].id:"",path:"",type:c.value,loaders:e.loaders||[]},le(),ie(),K.value=!0},le=()=>{if(ie(),!H.value)return;const a=H.value.replace(/\//g,"\\"),e=u.value.targetVersion;if(c.value==="modpack")u.value.path=`${a}\\versions`;else if(e){let s="mods";c.value==="shader"&&(s="shaderpacks"),c.value==="resourcepack"&&(s="resourcepacks"),u.value.path=`${a}\\versions\\${e}\\${s}`}else{let s="mods";c.value==="shader"&&(s="shaderpacks"),c.value==="resourcepack"&&(s="resourcepacks"),u.value.path=`${a}\\${s}`}},ie=()=>{if(D.value="",!u.value.targetVersion||c.value!=="mod")return;const a=j.value.find(y=>y.id===u.value.targetVersion);if(!a)return;const e=u.value.loaders.map(y=>y.toLowerCase());if(e.length===0)return;const s=a.id.toLowerCase();let r="vanilla";if(s.includes("fabric")?r="fabric":s.includes("forge")?r="forge":s.includes("neoforge")?r="neoforge":s.includes("quilt")?r="quilt":s.includes("optifine")&&(r="optifine"),r==="vanilla"){D.value=`ç›®æ ‡ç‰ˆæœ¬ä¼¼ä¹æ˜¯åŸç‰ˆï¼Œå¯èƒ½æ— æ³•åŠ è½½æ­¤ Modã€‚éœ€è¦å®‰è£… ${e.join("/")} åŠ è½½å™¨ã€‚`;return}e.some(y=>y===r||y==="fabric"&&r==="quilt")||(D.value=`åŠ è½½å™¨ä¸åŒ¹é…ï¼æ­¤èµ„æºéœ€è¦ ${e.join("/")}ï¼Œä½†ç›®æ ‡ç‰ˆæœ¬ä¼¼ä¹æ˜¯ ${r}ã€‚`)},ge=async()=>{try{const e=await(await p("/api/minecraft/select-dir")).json();e.ok&&(u.value.path=e.path)}catch(a){console.error("Select dir failed",a)}},ke=async()=>{if(!C.value){C.value=!0,v.value={filename:u.value.filename||"å‡†å¤‡ä¸‹è½½...",percent:0,total:0,current:0,message:"æ­£åœ¨åˆå§‹åŒ–..."};try{const e=await(await p("/api/resources/download",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:u.value.url,path:u.value.path,filename:u.value.filename,type:c.value})})).json();e.ok?A():(alert("ä¸‹è½½å¤±è´¥: "+e.error),v.value={filename:"",percent:0,total:0,current:0,message:""})}catch(a){console.error("Download failed",a),alert("ä¸‹è½½è¯·æ±‚å¤±è´¥"),v.value={filename:"",percent:0,total:0,current:0,message:""}}finally{C.value=!1}}},A=()=>{K.value=!1},Y=async(a=!1)=>{a||(m.value=!0,f.value=[]),ne.value=!0;try{let e=[];switch(c.value){case"mod":e.push('["project_type:mod"]');break;case"shader":e.push('["project_type:shader"]');break;case"modpack":e.push('["project_type:modpack"]');break;case"datapack":e.push('["categories:datapack"]');break;case"resourcepack":e.push('["project_type:resourcepack"]');break}L.value&&(c.value==="mod"||c.value==="modpack")&&e.push(`["categories:${L.value}"]`);const s=e.length>0?`[${e.join(",")}]`:"",r=a?G.value:0,M=new URLSearchParams({limit:"20",offset:r.toString()});s&&M.append("facets",s),S.value?M.append("query",S.value):M.append("index","downloads");const W=await(await p(`/api/resources/search?${M.toString()}`)).json();if(W.hits){if(a){const Ve=W.hits.filter(je=>!f.value.some(De=>De.project_id===je.project_id));f.value.push(...Ve)}else f.value=W.hits;J.value=W.total_hits}}catch(e){console.error("Search failed",e)}finally{m.value=!1}},ye=async a=>{X.value=a,Q.value=!0,$.value=[],P.value=!0,x.value="",I.value="";try{const s=await(await p(`/api/resources/versions/${a.slug}`)).json();Array.isArray(s)&&($.value=s)}catch(e){console.error("Failed to fetch versions",e)}finally{P.value=!1}},re=()=>{Q.value=!1,X.value=null},be=async a=>{if(!(a.translated_description||a.translating)){a.translating=!0;try{const e=await p(`/api/resources/translate/modrinth?project_id=${a.project_id}`);if(e.ok){const s=await e.json();s.translated&&(a.translated_description=s.translated)}}catch(e){console.error("Translation failed",e)}finally{a.translating=!1}}},Z=l(!1),T=l(!1),h=l({path:"",name:""}),we=async()=>{try{const e=await(await p("/api/system/pick-file")).json();if(e.ok&&e.path){h.value.path=e.path;const s=e.path.split(/[\\/]/).pop();h.value.name=s.replace(".mrpack",""),Z.value=!0}}catch(a){console.error("Pick file failed",a)}},F=()=>{Z.value=!1},Ce=async()=>{if(h.value.name){T.value=!0;try{const e=await(await p("/api/resources/import-mrpack",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:h.value.path,instance_name:h.value.name})})).json();e.ok?F():alert("å¯¼å…¥å¤±è´¥: "+e.error)}catch(a){console.error("Import failed",a),alert("è¯·æ±‚å¤±è´¥")}finally{T.value=!1}}},qe=se(()=>{const a=new Set;return $.value.forEach(e=>e.game_versions.forEach(s=>a.add(s))),Array.from(a).sort().reverse()}),Se=se(()=>{const a=new Set;return $.value.forEach(e=>e.loaders.forEach(s=>a.add(s))),Array.from(a).sort()}),ce=se(()=>$.value.filter(a=>!(x.value&&!a.game_versions.includes(x.value)||I.value&&!a.loaders.includes(I.value))));return ee(c,()=>{S.value="",O()}),Te(()=>{Y(),he()}),(a,e)=>(n(),o("div",We,[t("div",Ee,[e[10]||(e[10]=t("h3",{class:"section-title"},"ğŸ“¥ èµ„æºä¸‹è½½",-1)),t("div",Re,[(n(),o(_,null,g(q,s=>t("button",{key:s.id,class:Me(["tab-btn",{active:c.value===s.id}]),onClick:r=>c.value=s.id},i(s.name),11,Be)),64))]),t("div",Ge,[t("div",Je,[b(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>S.value=s),onKeyup:Ne(O,["enter"]),type:"text",class:"qq-input",placeholder:"æœç´¢èµ„æº..."},null,544),[[te,S.value]]),t("button",{onClick:O,class:"qq-btn",disabled:m.value},[m.value?(n(),o("span",Ke)):d("",!0),N(" "+i(m.value?"æœç´¢ä¸­...":"ğŸ” æœç´¢"),1)],8,ze)]),c.value==="mod"||c.value==="modpack"?(n(),o("div",He,[b(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>L.value=s),class:"qq-select filter-select",onChange:O},[...e[7]||(e[7]=[Ue('<option value="" data-v-3890cc76>å…¨éƒ¨åŠ è½½å™¨</option><option value="fabric" data-v-3890cc76>Fabric</option><option value="forge" data-v-3890cc76>Forge</option><option value="neoforge" data-v-3890cc76>NeoForge</option><option value="quilt" data-v-3890cc76>Quilt</option>',5)])],544),[[E,L.value]]),c.value==="modpack"?(n(),o("button",{key:0,onClick:we,class:"qq-btn secondary",style:{"margin-left":"12px"}}," ğŸ“¦ å¯¼å…¥æœ¬åœ° ")):d("",!0)])):d("",!0)]),f.value.length>0?(n(),o("div",Qe,[(n(!0),o(_,null,g(f.value,s=>(n(),o("div",{key:s.project_id,class:"resource-card"},[t("img",{src:s.icon_url||"/icons/mod.png",class:"resource-icon",alt:"icon"},null,8,Xe),t("div",Ye,[t("div",Ze,[t("h4",{class:"resource-title",title:s.title},i(s.title),9,es),t("div",ss,[!s.translated_description&&!s.translating?(n(),o("span",{key:0,onClick:R(r=>be(s),["stop"]),class:"translate-btn",title:"ç‚¹å‡»ç¿»è¯‘"},[...e[8]||(e[8]=[t("img",{src:Ae,alt:"ç¿»è¯‘",class:"translate-icon"},null,-1)])],8,ts)):d("",!0),s.translating?(n(),o("span",as)):d("",!0)])]),t("p",{class:"resource-desc",title:s.translated_description||s.description},i(s.translated_description||s.description),9,os),t("div",ns,[t("span",ls,"ğŸ‘¤ "+i(s.author),1),t("span",is,"â¬‡ï¸ "+i(ve(s.downloads)),1)]),t("div",rs,[t("a",{href:`https://modrinth.com/project/${s.slug}`,target:"_blank",class:"link-btn"},"ğŸŒ æŸ¥çœ‹",8,cs),t("button",{onClick:r=>ye(s),class:"download-btn"},"ğŸ“¥ é€‰æ‹©ç‰ˆæœ¬",8,us)])])]))),128))])):d("",!0),f.value.length>0&&J.value>f.value.length?(n(),o("div",{key:1,ref_key:"sentinel",ref:z,class:"sentinel"},[V.value?(n(),o("span",ds)):(n(),o("span",vs,"åŠ è½½æ›´å¤š..."))],512)):!m.value&&ne.value&&f.value.length===0?(n(),o("div",ps," æœªæ‰¾åˆ°ç›¸å…³èµ„æº ")):d("",!0),m.value?(n(),o("div",fs,[...e[9]||(e[9]=[t("span",{class:"loading-spinner"},null,-1),N(" æ­£åœ¨åŠ è½½... ",-1)])])):d("",!0)]),v.value.filename?(n(),o("div",ms,[t("div",hs,[t("span",{class:"filename",title:v.value.filename},i(v.value.percent>=100?"âœ…":"â¬‡ï¸")+" "+i(v.value.filename),9,_s),t("span",gs,i(v.value.percent)+"%",1)]),t("div",ks,[t("div",{class:"progress-bar-fill",style:Le({width:v.value.percent+"%"})},null,4)]),v.value.message?(n(),o("div",ys,i(v.value.message),1)):d("",!0)])):d("",!0),Q.value?(n(),o("div",{key:1,class:"modal-overlay",onClick:R(re,["self"])},[t("div",bs,[t("div",ws,[t("h3",null,"é€‰æ‹©ç‰ˆæœ¬ - "+i(X.value?.title),1),t("button",{class:"close-btn",onClick:re},"Ã—")]),t("div",Cs,[b(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>x.value=s),class:"qq-select"},[e[11]||(e[11]=t("option",{value:""},"å…¨éƒ¨æ¸¸æˆç‰ˆæœ¬",-1)),(n(!0),o(_,null,g(qe.value,s=>(n(),o("option",{key:s,value:s},i(s),9,qs))),128))],512),[[E,x.value]]),b(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>I.value=s),class:"qq-select"},[e[12]||(e[12]=t("option",{value:""},"å…¨éƒ¨åŠ è½½å™¨",-1)),(n(!0),o(_,null,g(Se.value,s=>(n(),o("option",{key:s,value:s},i(s),9,Ss))),128))],512),[[E,I.value]])]),P.value?(n(),o("div",Vs,[...e[13]||(e[13]=[t("span",{class:"loading-spinner"},null,-1),N(" åŠ è½½ä¸­... ",-1)])])):d("",!0),ce.value.length>0?(n(),o("div",js,[(n(!0),o(_,null,g(ce.value,s=>(n(),o("div",{key:s.id,class:"version-item"},[t("div",Ds,[t("span",{class:"version-name",title:s.name},i(s.name),9,$s),t("span",xs,i(s.version_number),1)]),t("div",Is,[(n(!0),o(_,null,g(s.game_versions,r=>(n(),o("span",{key:r,class:"tag game-ver"},i(r),1))),128)),(n(!0),o(_,null,g(s.loaders,r=>(n(),o("span",{key:r,class:"tag loader"},i(r),1))),128))]),t("div",Ts,[t("span",Ms,i(pe(s.date_published)),1),t("button",{onClick:r=>_e(s.files[0],s),class:"download-btn-sm"}," â¬‡ï¸ ä¸‹è½½ ",8,Ns)])]))),128))])):P.value?d("",!0):(n(),o("div",Us," æœªæ‰¾åˆ°ç‰ˆæœ¬ "))])])):d("",!0),K.value?(n(),o("div",{key:2,class:"modal-overlay",onClick:R(A,["self"])},[t("div",Ls,[t("div",Ps,[t("h3",null,"ä¸‹è½½é…ç½® - "+i(u.value.filename),1),t("button",{class:"close-btn",onClick:A},"Ã—")]),t("div",Os,[t("div",As,[e[15]||(e[15]=t("label",null,"ç›®æ ‡æ¸¸æˆç‰ˆæœ¬",-1)),b(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>u.value.targetVersion=s),class:"qq-select full-width",onChange:le},[e[14]||(e[14]=t("option",{value:"",disabled:""},"é€‰æ‹©ç‰ˆæœ¬...",-1)),(n(!0),o(_,null,g(j.value,s=>(n(),o("option",{key:s.id,value:s.id},i(s.id),9,Fs))),128))],544),[[E,u.value.targetVersion]]),c.value==="modpack"?(n(),o("div",Ws,"æ•´åˆåŒ…å°†ä¸‹è½½åˆ° versions ç›®å½•ä¸‹")):d("",!0),D.value?(n(),o("div",Es,"âš ï¸ "+i(D.value),1)):d("",!0)]),t("div",Rs,[e[16]||(e[16]=t("label",null,"å®‰è£…è·¯å¾„",-1)),t("div",Bs,[b(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=s=>u.value.path=s),class:"qq-input full-width"},null,512),[[te,u.value.path]]),t("button",{onClick:ge,class:"qq-btn secondary"},"ğŸ“‚ æµè§ˆ")]),u.value.path?(n(),o("div",Gs," æœ€ç»ˆä½ç½®: "+i(u.value.path)+"\\"+i(u.value.filename),1)):d("",!0)])]),t("div",Js,[t("button",{onClick:A,class:"qq-btn secondary"},"å–æ¶ˆ"),t("button",{onClick:ke,class:"qq-btn primary",disabled:C.value},[C.value?(n(),o("span",Ks)):d("",!0),N(" "+i(C.value?"æäº¤ä¸­...":"å¼€å§‹ä¸‹è½½"),1)],8,zs)])])])):d("",!0),Z.value?(n(),o("div",{key:3,class:"modal-overlay",onClick:R(F,["self"])},[t("div",Hs,[t("div",{class:"modal-header"},[e[17]||(e[17]=t("h3",null,"å¯¼å…¥æ•´åˆåŒ…",-1)),t("button",{class:"close-btn",onClick:F},"Ã—")]),t("div",Qs,[t("div",Xs,[e[18]||(e[18]=t("label",null,"æ•´åˆåŒ…æ–‡ä»¶",-1)),t("div",Ys,i(h.value.path),1)]),t("div",Zs,[e[19]||(e[19]=t("label",null,"å®ä¾‹åç§° (ç‰ˆæœ¬ID)",-1)),b(t("input",{type:"text","onUpdate:modelValue":e[6]||(e[6]=s=>h.value.name=s),class:"qq-input full-width",placeholder:"è¯·è¾“å…¥å®ä¾‹åç§°"},null,512),[[te,h.value.name]]),e[20]||(e[20]=t("div",{class:"hint-text"},"å°†åˆ›å»ºä¸€ä¸ªæ–°çš„ç‰ˆæœ¬éš”ç¦»å®ä¾‹",-1))])]),t("div",et,[t("button",{onClick:F,class:"qq-btn secondary"},"å–æ¶ˆ"),t("button",{onClick:Ce,class:"qq-btn primary",disabled:T.value},[T.value?(n(),o("span",tt)):d("",!0),N(" "+i(T.value?"å¯¼å…¥ä¸­...":"å¼€å§‹å¯¼å…¥"),1)],8,st)])])])):d("",!0)]))}}),nt=Oe(at,[["__scopeId","data-v-3890cc76"]]);export{nt as default};
