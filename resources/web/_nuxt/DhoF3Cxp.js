import{j as G,l as H,r as d,n as K,C as Q,B as R,c as l,o as a,q as h,a as s,D as B,E as m,b as W,w as X,d as b,e as Y,v as f,F as j,s as D,t as o,G as E,T as $,x as Z,z as ss,_ as es}from"./bZTsdcjj.js";const ts={class:"sync-page"},ns={key:0,class:"not-connected-overlay"},as={class:"overlay-content"},ls=["disabled"],os={class:"section-header"},is=["disabled"],ds={key:0,class:"loading-state"},cs={key:1,class:"empty-state"},rs={key:2,class:"shares-grid"},us={class:"share-header"},vs={class:"device-info"},_s={class:"device-name"},fs={class:"device-ip"},ps={class:"share-body"},ys={class:"folder-info"},ms={class:"folder-label"},hs={class:"folder-id"},bs={class:"share-actions"},ks=["onClick"],gs={class:"section-header"},qs={class:"local-shares-list"},ws={class:"item-details"},Cs={class:"item-name"},Ss={class:"item-path"},xs={class:"item-status"},Ts={key:0,class:"empty-local"},Ms={class:"modal-container"},Ns={class:"modal-body"},js={key:0,class:"loading-state small"},Ds={key:1,class:"empty-state small"},Bs={key:2,class:"saves-list"},Es=["onClick"],$s={class:"save-icon"},Ls=["src"],Vs={key:1},Is={class:"save-info"},Os={class:"save-name"},Ps={class:"save-version"},zs={class:"save-time"},Fs={class:"save-check"},Js={key:0,class:"shared-badge"},Us={key:1,class:"check-mark"},As={class:"modal-footer"},Gs=["disabled"],Hs={class:"modal-container"},Ks={class:"modal-body"},Qs={class:"form-group"},Rs={class:"info-box"},Ws={class:"form-group"},Xs={class:"input-group"},Ys={class:"modal-footer"},Zs=["disabled"],se=G({__name:"sync",setup(ee){const{fetchApi:p,networkStatus:y}=R(),{showToast:r}=H(),k=d(!1),S=d([]),v=d({running:!1,folders:[]}),x=d(!1),T=d(!1),g=d([]),c=d(null),M=d(!1),i=d(null),_=d(""),u=d(!1);K(()=>{N(),q(),Q(q,5e3)});async function N(){k.value=!0;try{const e=await(await p("/api/sync/peers")).json();e.ok&&(S.value=e.shares)}catch(n){console.error(n)}finally{k.value=!1}}async function q(){try{const e=await(await p("/api/sync/status")).json();e.ok?v.value={running:!0,folders:e.folders||[]}:v.value.running=!1}catch{v.value.running=!1}}async function L(){x.value=!0,T.value=!0,g.value=[],c.value=null;try{const e=await(await p("/api/sync/local_saves")).json();e.ok&&(g.value=e.saves)}catch(n){r(`åŠ è½½å­˜æ¡£å¤±è´¥: ${n.message}`,"error")}finally{T.value=!1}}function w(){x.value=!1}function V(n){c.value=n}async function I(){if(c.value){u.value=!0;try{const e=await(await p("/api/sync/share",{method:"POST",body:JSON.stringify({version_id:c.value.version_id,save_name:c.value.name,save_path:c.value.path})})).json();e.ok?(r("åˆ†äº«æˆåŠŸ","success"),w(),q()):r(e.error||"åˆ†äº«å¤±è´¥","error")}catch(n){r(`åˆ†äº«å¤±è´¥: ${n.message}`,"error")}finally{u.value=!1}}}function O(n){i.value=n,M.value=!0,_.value="";const e=n.folder_id.split("-");e.length>=3&&e[0]}function C(){M.value=!1,i.value=null}async function P(){try{const e=await(await p("/api/minecraft/select-dir")).json();e.ok&&(_.value=e.path)}catch(n){r(`é€‰æ‹©ç›®å½•å¤±è´¥: ${n.message}`,"error")}}async function z(){if(!(!i.value||!_.value)){u.value=!0;try{const e=await(await p("/api/sync/connect",{method:"POST",body:JSON.stringify({device_id:i.value.device_id,device_ip:i.value.device_ip,device_name:i.value.device_name,folder_id:i.value.folder_id,folder_label:i.value.folder_label,local_path:_.value})})).json();e.ok?(r("è¿æ¥æˆåŠŸï¼Œå¼€å§‹åŒæ­¥","success"),C(),q(),N()):r(e.error||"è¿æ¥å¤±è´¥","error")}catch(n){r(`è¿æ¥å¤±è´¥: ${n.message}`,"error")}finally{u.value=!1}}}function F(n){return new Date(n*1e3).toLocaleString()}function J(n){return""}return(n,e)=>{const U=Y;return a(),l("div",ts,[m(y).connected?h("",!0):(a(),l("div",ns,[s("div",as,[e[2]||(e[2]=s("div",{class:"warning-icon"},"âš ï¸",-1)),e[3]||(e[3]=s("h3",null,"æœªè¿æ¥åˆ° EasyTier ç½‘ç»œ",-1)),e[4]||(e[4]=s("p",null,"å­˜æ¡£åŒæ­¥åŠŸèƒ½ä¾èµ– EasyTier è™šæ‹Ÿç½‘ç»œã€‚è¯·å…ˆå¯åŠ¨è”æœºæœåŠ¡ã€‚",-1)),W(U,{to:"/",class:"qq-btn qq-btn-primary mt-4"},{default:X(()=>[...e[1]||(e[1]=[b(" å‰å¾€å¯åŠ¨ EasyTier ",-1)])]),_:1})])])),s("div",{class:f(["panel-section action-bar",{blurred:!m(y).connected}])},[e[6]||(e[6]=s("div",{class:"header-content"},[s("h3",{class:"section-title mb-0"},"â˜ï¸ å­˜æ¡£åŒæ­¥ä¸­å¿ƒ"),s("p",{class:"header-desc"},"åœ¨ EasyTier ç½‘ç»œä¸­åˆ†äº«å’ŒåŒæ­¥æ‚¨çš„ Minecraft å­˜æ¡£")],-1)),s("button",{onClick:L,class:"qq-btn qq-btn-primary share-btn",disabled:!m(y).connected},[...e[5]||(e[5]=[s("span",{class:"btn-icon"},"ğŸ“¤",-1),b(" åŒæ­¥æˆ‘çš„å­˜æ¡£ ",-1)])],8,ls)],2),s("div",{class:f(["panel-section",{blurred:!m(y).connected}])},[s("div",os,[e[7]||(e[7]=s("h3",{class:"section-title"},"ğŸŒ å‘ç°æ–°å­˜æ¡£",-1)),s("button",{onClick:N,class:f(["refresh-btn",{spinning:k.value}]),disabled:!m(y).connected}," ğŸ”„ ",10,is)]),k.value?(a(),l("div",ds,[...e[8]||(e[8]=[s("div",{class:"spinner"},null,-1),s("span",null,"æ­£åœ¨æ‰«æç½‘ç»œåˆ†äº«...",-1)])])):S.value.length===0?(a(),l("div",cs,[...e[9]||(e[9]=[s("span",{class:"empty-icon"},"ğŸ“­",-1),s("span",null,"å½“å‰ç½‘ç»œä¸­æ²¡æœ‰å‘ç°æ–°å­˜æ¡£",-1),s("span",{class:"sub-text"},'å·²åŒæ­¥çš„å­˜æ¡£è¯·åœ¨ä¸‹æ–¹"æˆ‘çš„åŒæ­¥"ä¸­æŸ¥çœ‹',-1)])])):(a(),l("div",rs,[(a(!0),l(j,null,D(S.value,t=>(a(),l("div",{key:t.folder_id,class:"share-card"},[s("div",us,[s("div",vs,[e[10]||(e[10]=s("span",{class:"device-icon"},"ğŸ’»",-1)),s("span",_s,o(t.device_name),1),s("span",fs,o(t.device_ip),1)]),e[11]||(e[11]=s("div",{class:"share-status"}," å¯ä¸‹è½½ ",-1))]),s("div",ps,[e[12]||(e[12]=s("div",{class:"folder-icon"},"ğŸ“",-1)),s("div",ys,[s("div",ms,o(t.folder_label),1),s("div",hs,"ID: "+o(t.folder_id),1)])]),s("div",bs,[s("button",{onClick:A=>O(t),class:"qq-btn qq-btn-sm qq-btn-secondary"}," ğŸ“¥ ä¸‹è½½å¹¶åŒæ­¥ ",8,ks)])]))),128))]))],2),s("div",{class:f(["panel-section",{blurred:!m(y).connected}])},[s("div",gs,[e[14]||(e[14]=s("h3",{class:"section-title"},"ğŸ“‚ æˆ‘çš„åŒæ­¥",-1)),s("div",{class:f(["status-badge",{active:v.value.running}])},[e[13]||(e[13]=s("span",{class:"status-dot"},null,-1)),b(" "+o(v.value.running?"æœåŠ¡è¿è¡Œä¸­":"æœåŠ¡å·²åœæ­¢"),1)],2)]),s("div",qs,[(a(!0),l(j,null,D(v.value.folders,t=>(a(),l("div",{key:t.id,class:"local-share-item"},[e[15]||(e[15]=s("div",{class:"item-icon"},"ğŸ”„",-1)),s("div",ws,[s("div",Cs,o(t.label),1),s("div",Ss,o(t.path),1)]),s("div",xs,[s("span",{class:f(["status-tag",t.paused?"paused":"synced"])},o(t.paused?"â¸ï¸ å·²æš‚åœ":"âœ… åŒæ­¥ä¸­"),3)])]))),128)),v.value.folders.length===0?(a(),l("div",Ts,[...e[16]||(e[16]=[s("span",null,"æš‚æ— æ­£åœ¨åŒæ­¥çš„ç›®å½•",-1)])])):h("",!0)])],2),(a(),B($,{to:"body"},[x.value?(a(),l("div",{key:0,class:"modal-overlay",onClick:E(w,["self"])},[s("div",Ms,[s("div",{class:"modal-header"},[e[17]||(e[17]=s("h3",null,"ğŸ“¤ é€‰æ‹©è¦åŒæ­¥çš„å­˜æ¡£",-1)),s("button",{class:"close-btn",onClick:w},"Ã—")]),s("div",Ns,[T.value?(a(),l("div",js,[...e[18]||(e[18]=[s("div",{class:"spinner"},null,-1),s("span",null,"åŠ è½½å­˜æ¡£ä¸­...",-1)])])):g.value.length===0?(a(),l("div",Ds,[...e[19]||(e[19]=[s("span",null,"æ²¡æœ‰æ‰¾åˆ°æœ¬åœ°å­˜æ¡£",-1)])])):(a(),l("div",Bs,[(a(!0),l(j,null,D(g.value,t=>(a(),l("div",{key:t.path,class:f(["save-item",{selected:c.value===t,shared:t.is_shared}]),onClick:A=>!t.is_shared&&V(t)},[s("div",$s,[t.has_icon?(a(),l("img",{key:0,src:J(),alt:"icon"},null,8,Ls)):(a(),l("span",Vs,"ğŸ“¦"))]),s("div",Is,[s("div",Os,o(t.name),1),s("div",Ps,"ç‰ˆæœ¬: "+o(t.version_id),1),s("div",zs,o(F(t.last_modified)),1)]),s("div",Fs,[t.is_shared?(a(),l("span",Js,"å·²åˆ†äº«")):c.value===t?(a(),l("span",Us,"âœ“")):h("",!0)])],10,Es))),128))]))]),s("div",As,[s("button",{class:"qq-btn qq-btn-ghost",onClick:w},"å–æ¶ˆ"),s("button",{class:"qq-btn qq-btn-primary",disabled:!c.value||u.value,onClick:I},o(u.value?"æäº¤ä¸­...":"ç¡®å®šåˆ†äº«"),9,Gs)])])])):h("",!0)])),(a(),B($,{to:"body"},[M.value?(a(),l("div",{key:0,class:"modal-overlay",onClick:E(C,["self"])},[s("div",Hs,[s("div",{class:"modal-header"},[e[20]||(e[20]=s("h3",null,"ğŸ“¥ è¿æ¥åŒæ­¥å­˜æ¡£",-1)),s("button",{class:"close-btn",onClick:C},"Ã—")]),s("div",Ks,[s("div",Qs,[e[23]||(e[23]=s("label",null,"è¿œç¨‹å­˜æ¡£",-1)),s("div",Rs,[s("div",null,[e[21]||(e[21]=s("strong",null,"åç§°:",-1)),b(" "+o(i.value?.folder_label),1)]),s("div",null,[e[22]||(e[22]=s("strong",null,"æ¥æº:",-1)),b(" "+o(i.value?.device_name)+" ("+o(i.value?.device_ip)+")",1)])])]),s("div",Ws,[e[24]||(e[24]=s("label",null,"é€‰æ‹©æœ¬åœ°å­˜æ”¾ä½ç½®",-1)),s("div",Xs,[Z(s("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>_.value=t),placeholder:"é€‰æ‹©æˆ–è¾“å…¥æœ¬åœ°è·¯å¾„",readonly:""},null,512),[[ss,_.value]]),s("button",{onClick:P,class:"qq-btn qq-btn-sm"},"ğŸ“‚ é€‰æ‹©")]),e[25]||(e[25]=s("p",{class:"hint"},"å»ºè®®é€‰æ‹©å¯¹åº”ç‰ˆæœ¬çš„ saves ç›®å½•ä¸‹çš„åŒåæ–‡ä»¶å¤¹",-1))])]),s("div",Ys,[s("button",{class:"qq-btn qq-btn-ghost",onClick:C},"å–æ¶ˆ"),s("button",{class:"qq-btn qq-btn-primary",disabled:!_.value||u.value,onClick:z},o(u.value?"è¿æ¥ä¸­...":"å¼€å§‹åŒæ­¥"),9,Zs)])])])):h("",!0)]))])}}}),ne=es(se,[["__scopeId","data-v-00d28901"]]);export{ne as default};
